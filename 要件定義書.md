# 要件定義書（Version 1.0）
体験型・制約付き塗り絵サービス **PolyCanvas（ポリキャンバス）**

---

# 1. 概要

## 1.1 サービス概要
**PolyCanvas** は、毎回ランダム生成される多角形セル群（幾何学模様）に対して、
ユーザーが自由に色を塗る体験を提供するミニマルな創作サービスである。
模様は中心付近のみ可視化された状態で開始し、セルを塗り進めることで視野が段階的に拡大していく。

塗ったセルは不可逆（上書き不可）であり、ユーザーは「思い通りにいかない創作」「不可逆な選択」「探索の焦り」を体験する。

終了方式は以下の2種類：  
- 全セル塗り切りによる自動終了  
- 任意のタイミングで「この状態で終える」ボタンによる終了

## 1.2 目的
- 完成形を提示せず、過程そのものを価値にする創作体験を提供する  
- 毎回異なる幾何学模様による“一期一会の表現”を実現する  
- 不可逆操作による緊張感と没入感を強める  
- 保存・ログインを排し、1回性の体験価値を最大化する  
- 広告＋SNS共有のみを備えたシンプルなミニマル体験とする  

---

# 2. スコープ

## 2.1 MVPで実装する機能
- アクセス時に幾何学模様を自動生成  
- 初期視野は中心から一定距離のみ可視  
- セル塗り（16色パレット）  
- 塗り直し不可（不可逆操作）  
- 視野拡大（距離閾値による段階的可視化）  
- 終了方式（自動終了・任意終了）  
- 完了画面でSNS共有（X投稿、Instagram向け画像DL）  
- 開始前画面／完了画面で広告表示  
- 誤タップ対策（事前ハイライト＋モバイル短い長押し）  
- 操作説明は最小限、進捗表示なし  
- 戻る／リセットなし  

## 2.2 MVPで実装しない機能
- 保存機能  
- ログイン機能  
- テンプレート選択  
- 評価・スコア・ランキング  
- 他ユーザーとの交流  
- 色テーマ変更  
- タイムラプス再生  
- アプリ化（将来検討）  

---

# 3. 体験仕様（UX）

## 3.1 開始前画面
- 説明文（例：「これは思い通りに描くためのツールではありません。」）  
- 静的バナー広告  
- STARTボタンで体験画面へ遷移  

## 3.2 体験画面
- 生成された幾何学模様の中心付近のみ可視  
- 画面上部または下部に **16色パレットを表示**  
- セルをタップ／クリックで色を塗る（不可逆）  
- 塗るほど視野が段階的に開放  
- メッセージは極力非表示にし、没入感を維持  
- 誤タップ対策  
  - PC：hoverで事前ハイライト  
  - モバイル：touch開始でハイライト＋0.18〜0.22秒の短い長押し  
- 「この状態で終える」ボタン常設 → 確認後終了  

## 3.3 完了画面
- 塗り終えた状態を静止表示  
- 「終了しました」のみとし、評価しない  
- 静的バナー広告  
- X投稿ボタン・Instagram用DLボタン  
- 完了後は状態破棄し再開不可  

---

# 4. 幾何学模様仕様（毎回生成）

## 4.1 概要
幾何学模様は、アクセスごとに生成される多角形セルの集合。  
形状は不規則であり、毎回異なる構造を持つ。

## 4.2 セル数
- 目標：80〜400セル（20×20相当の密度）  
- 生成後に範囲外の場合は再生成またはパラメータ調整  

---

# 5. 幾何学模様生成ルール（4層構造）

## 5.1 Layer 1：点配置（Poisson Disk Sampling）
- 生成領域：1×1 正方形座標  
- 点数：100〜200  
- minDist＝0.04 推奨  
- Poisson Disk により偏りを抑制し、均質なセパレーションを確保  

## 5.2 Layer 2：Voronoi 分割
- ランダム点群からVoronoi図を構築  
- 各セル＝多角形として採用  
- polygon形式で保持  
- 隣接情報を必要に応じて保持  

## 5.3 Layer 3：形状補正
### 5.3.1 最小面積フィルタ  
- 面積が A_min（全体の1/600〜1/800）未満の場合：  
  → 隣接セルと統合  

### 5.3.2 細長セルフィルタ  
- 外接矩形のアスペクト比 AR > 3.0 の場合：  
  → 統合・補正  

### 5.3.3 境界巨大セル防止  
- 領域外辺近くで平均面積の5倍以上のセル：  
  → 分割・統合  

## 5.4 Layer 4：視野中心調整
- 中心（bounds中央）から半径10%以内に最低6セル  
- 不足時：点追加→再生成、またはセパレーション調整  

---

# 6. セル属性

## 6.1 重心（Centroid）
- 多角形の重心を計算  
- 視野可視判定に利用  

## 6.2 隣接情報
- 必要に応じて塗り広がり演出などに応用可能  

---

# 7. ランダムシード管理
- 通常は毎回ランダムシードで生成  
- デバッグ用途で固定シード（?seed=1234）を許可  

---

# 8. 16色パレット仕様（最終決定）

## 8.1 パレット（HEX値）
```
01  #000000  （ブラック）
02  #4B4B4B  （ダークグレー）
03  #808080  （グレー）
04  #C8C8C8  （ライトグレー）

05  #E53935  （レッド）
06  #FB8C00  （オレンジ）
07  #FDD835  （イエロー）
08  #43A047  （グリーン）

09  #1E88E5  （ブルー）
10  #5E35B1  （パープル）
11  #8E24AA  （バイオレット）
12  #D81B60  （ローズ）

13  #6D4C41  （ブラウン）
14  #F06292  （ピンク）
15  #7CB342  （ライトグリーン）
16  #29B6F6  （シアン）
```

## 8.2 パレット設計意図
- 暖色8／寒色8のバランス  
- 極端な蛍光色や暗部色を避け、“失敗しにくい”色構成  
- Voronoi系幾何模様との視認性が高い  
- 明度・彩度が自然に揃っているため、任意の組合わせでも破綻しない  

---

# 9. 初期視野・視野拡大

## 9.1 中心座標
- bounds の中央を center として定義  

## 9.2 初期視野
- 中心から距離 d0 以下のセルを可視  
- 推奨：外接矩形対角の 7%  

## 9.3 視野拡大（8段階）

| レベル | 距離閾値 |
|--------|----------|
| 0 | 7% |
| 1 | 11% |
| 2 | 15% |
| 3 | 20% |
| 4 | 30% |
| 5 | 45% |
| 6 | 65% |
| 7 | 85% |
| 8 | 100% |

---

# 10. 視野拡大トリガー（塗り割合）

| レベル | 累計塗り割合 |
|--------|----------------|
| 1 | 3% |
| 2 | 6% |
| 3 | 10% |
| 4 | 16% |
| 5 | 24% |
| 6 | 34% |
| 7 | 50% |
| 8 | 70% |

---

# 11. 色塗り仕様

## 11.1 操作
- パレットから色選択  
- セルをタップ／クリックで塗る  
- 塗り直し不可（不可逆）  

## 11.2 パレットUI
- 16色を横一列または2列配置  
- 選択色は枠線で明示  

---

# 12. 誤タップ対策

## 12.1 事前ハイライト
- PC：hoverでセル枠を薄く表示  
- モバイル：touch開始でハイライト  

## 12.2 モバイルの短い長押し
- 0.18〜0.22秒  
- 長押し中は軽い強調表示  
- 指を離した瞬間に塗り確定  

---

# 13. 終了仕様

## 13.1 自動終了
- 全セル塗り終えたタイミングで終了画面へ遷移  

## 13.2 任意終了
- 「この状態で終える」ボタン  
- 確認ダイアログあり  

---

# 14. SNS共有仕様

## 14.1 出力画像
- PNG形式  
- 1080×1080  
- 背景：白 or 黒  
- 右下にサービス名を小さく表示  

## 14.2 X投稿
```
制約付き塗り体験を終えました。
#制約塗り絵
```

## 14.3 Instagram共有
- 画像DLのみ提供  

---

# 15. 非機能要件
- 80〜400セルの描画がスマホ／PCで快適に動作  
- 30分以上の操作でも遅延やクラッシュがない  
- リロードで新規開始  
- 個人情報を保持しない  
- 幾何学生成パラメータは環境に合わせて調整可能  

---

# 16. 広告仕様
- 開始前画面・完了画面で静的バナー広告表示  
- 体験画面では広告禁止  
- ポップアップ・動画広告は採用しない  

---

# 17. 将来拡張
- 幾何学生成アルゴリズムのバリエーション  
- 色テーマの追加  
- ギャラリー・保存機能  
- シェアフレーム  
- タイムラプス生成  
- アプリ版  

---

# 18. 用語定義
- セル：多角形領域  
- 重心：セルの中心位置  
- Poisson Disk Sampling：均等性のあるランダム点生成  
- Voronoi：点群に基づく多角形分割  
- 不可逆操作：塗ったセルが変更できない仕様  
- 短い長押し：モバイルでの塗り確定方式  
- 距離閾値：可視化判定に用いる中心からの距離  
- 視野拡大：距離閾値の上昇による可視セル増加  

